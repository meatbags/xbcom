var XB=function(t){function e(o){if(i[o])return i[o].exports;var s=i[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,o){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";var o=i(1),s=function(t){return t&&t.__esModule?t:{default:t}}(o),n={init:function(){n.renderer=new THREE.WebGLRenderer,n.renderer.setSize(960,540),n.renderer.setClearColor(16377314,1),document.getElementById("wrapper").appendChild(n.renderer.domElement),n.scene=new s.default(n.renderer.domElement),window.onresize=n.resize,n.ready=!0,n.time=(new Date).getTime()},resize:function(){n.scene.resize()},loop:function(){requestAnimationFrame(n.loop);var t=(new Date).getTime(),e=(t-n.time)/1e3;n.time=t,n.ready&&(n.scene.update(e),n.renderer.render(n.scene.scene,n.scene.camera))}};window.onload=n.init},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(2),s=function(t){return t&&t.__esModule?t:{default:t}}(o),n=function(t){this.domElement=t,this.init()};n.prototype={init:function(){this.scene=new THREE.Scene,this.player=new s.default(this.domElement),this.camera=this.player.camera,this.collider=new Collider.System},update:function(t){this.player.update(t,this.collider)},resize:function(){}},e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(3),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(o),n=function(t){this.domElement=t,this.position=new THREE.Vector3(0,0,0),this.movement=new THREE.Vector3(0,0,0),this.rotation=new THREE.Vector3(0,Math.PI,0),this.offset={rotation:new THREE.Vector3(0,0,0)},this.target={position:new THREE.Vector3(0,0,0),movement:new THREE.Vector3(0,0,0),rotation:new THREE.Vector3(0,Math.PI,0),offset:{rotation:new THREE.Vector3(0,0,0)}},this.attributes={speed:8,speedWhileJumping:4,height:1.8,rotation:.75*Math.PI,fov:58,cameraThreshold:.4,maxRotationOffset:.3*Math.PI,falling:!1,adjust:{slow:.02,normal:.05,fast:.09,veryFast:.2},climb:{up:1,down:.5,minYNormal:.5},gravity:{accel:10,maxVelocity:50,jumpVelocity:5}},this.outputLog=[],this.camera=new THREE.PerspectiveCamera(this.attributes.fov,1,.1,1e4),this.camera.up=new THREE.Vector3(0,1,0),this.init()};n.prototype={init:function(){this.object=new THREE.Mesh(new THREE.SphereBufferGeometry(.05),new THREE.MeshPhongMaterial),this.bindControls(),this.resizeCamera()},resizeCamera:function(){var t=this.domElement.width,e=this.domElement.height;this.camera.aspect=t/e,this.camera.updateProjectionMatrix()},bindControls:function(){var t=this;t.domElement.addEventListener("mousemove",function(e){t.handleMouseMove(e)},!1),t.domElement.addEventListener("mousedown",function(e){t.handleMouseDown(e)},!1),t.keys={up:!1,down:!1,left:!1,right:!1,jump:!1},document.addEventListener("keydown",function(e){t.handleKeyDown(e)},!1),document.addEventListener("keyup",function(e){t.handleKeyUp(e)},!1)},log:function(){for(var t="",e=0;e<arguments.length;e+=1)t+=arguments[e]+" ";this.outputLog.push(t)},update:function(t,e){if(this.outputLog=[],this.keys.up||this.keys.down){var i=(this.keys.up?1:0)+(this.keys.down?-1:0),o=this.rotation.y+this.offset.rotation.y,n=Math.sin(o)*this.attributes.speed*i,r=Math.cos(o)*this.attributes.speed*i;this.target.movement.x=n,this.target.movement.z=r}else this.target.movement.x=0,this.target.movement.z=0;this.keys.jump&&(this.keys.jump=!1,0==this.movement.y&&(this.movement.y=this.attributes.gravity.jumpVelocity)),this.falling=0!=this.movement.y,this.falling?(this.movement.x+=(this.target.movement.x-this.movement.x)*this.attributes.adjust.slow,this.movement.z+=(this.target.movement.z-this.movement.z)*this.attributes.adjust.slow):(this.movement.x=this.target.movement.x,this.movement.z=this.target.movement.z);var a=s.addVector(s.scaleVector(this.movement,t),this.target.position),h=e.collisions(a);if(this.movement.y=Math.max(this.movement.y-this.attributes.gravity.accel*t,-this.attributes.gravity.maxVelocity),h.length>0){this.log("Collisions",h.length);for(var u=0;u<h.length;u+=1){var c=h[u].ceilingPlane(a);null!=c.y&&c.plane.normal.y>=this.attributes.climb.minYNormal&&c.y-this.target.position.y<=this.attributes.climb.up&&(this.movement.y=0,c.y>=a.y&&(a.y=c.y,this.log("CLIMBED")))}h=e.collisions(a);for(var l=[],m=0;m<h.length;m+=1){var f=h[m].ceilingPlane(a);null!=f.y&&(f.plane.normal.y<this.attributes.climb.minYNormal||f.y-this.target.position.y>this.attributes.climb.up)&&l.push(h[m])}if(l.length>0){for(var y=s.copyVector(a),d=0;d<l.length;d+=1){y=l[d].nearest2DIntersect(this.target.position,a)}a.x=y.x,a.z=y.z,this.object.position.set(a.x,a.y,a.z);var p=0;h=e.collisions(a);for(var v=0;v<h.length;v+=1){var g=h[v].ceilingPlane(a);null!=g.y&&(g.plane.normal.y<this.attributes.climb.minYNormal||g.y-this.target.position.y>this.attributes.climb.up)&&(p+=1)}p>1&&(a.x=this.target.position.x,a.z=this.target.position.z)}}else{var w=s.copyVector(a);if(w.y-=this.attributes.climb.down,!this.falling&&e.collision(w)){var E=e.ceilingPlane(w);E.plane.normal.y>=this.attributes.climb.minYNormal&&(a.y=E.y,this.movement.y=0)}}if(this.target.position.x=a.x,this.target.position.y=a.y,this.target.position.z=a.z,this.position.x+=(this.target.position.x-this.position.x)*this.attributes.adjust.veryFast,this.position.y+=(this.target.position.y-this.position.y)*this.attributes.adjust.veryFast,this.position.z+=(this.target.position.z-this.position.z)*this.attributes.adjust.veryFast,this.keys.left||this.keys.right){var b=(this.keys.left?1:0)+(this.keys.right?-1:0);this.target.rotation.y+=this.attributes.rotation*t*b}this.rotation.y+=s.minAngleDifference(this.rotation.y,this.target.rotation.y)*this.attributes.adjust.fast,this.offset.rotation.x+=(this.target.offset.rotation.x-this.offset.rotation.x)*this.attributes.adjust.normal,this.offset.rotation.y+=(this.target.offset.rotation.y-this.offset.rotation.y)*this.attributes.adjust.normal,this.rotation.y+=this.rotation.y<0?s.twoPi:this.rotation.y>s.twoPi?-s.twoPi:0;var x=this.rotation.y+this.offset.rotation.y,z=this.rotation.x+this.offset.rotation.x,M=this.position.y+this.attributes.height;this.camera.position.set(this.position.x,M,this.position.z),this.camera.lookAt(new THREE.Vector3(this.position.x+Math.sin(x),M+Math.sin(z),this.position.z+Math.cos(x)))},handleKeyDown:function(t){switch(t.keyCode){case 38:case 87:this.keys.up=!0;break;case 37:case 65:this.keys.left=!0;break;case 40:case 83:this.keys.down=!0;break;case 39:case 68:this.keys.right=!0;break;case 32:this.keys.jump=!0}},handleKeyUp:function(t){switch(t.keyCode){case 38:case 87:this.keys.up=!1;break;case 37:case 65:this.keys.left=!1;break;case 40:case 83:this.keys.down=!1;break;case 39:case 68:this.keys.right=!1}},handleMouseDown:function(t){var e=this.domElement.getBoundingClientRect(),i=this.domElement.width,o=(t.clientX-e.left)/i,s=this.attributes.cameraThreshold;this.target.rotation.y=o<s?this.rotation.y+(s-o)/s*this.attributes.maxRotationOffset:o>1-s?this.rotation.y+(o-(1-s))/s*-this.attributes.maxRotationOffset:this.rotation.y},handleMouseMove:function(t){var e=this.domElement.getBoundingClientRect(),i=this.domElement.width,o=this.domElement.height,s=(t.clientX-e.left)/i,n=(t.clientY-e.top)/o,r=this.attributes.cameraThreshold;this.target.offset.rotation.y=s<r?(r-s)/r*this.attributes.maxRotationOffset:s>1-r?(s-(1-r))/r*-this.attributes.maxRotationOffset:0,this.target.offset.rotation.x=n<r?(r-n)/r*this.attributes.maxRotationOffset:n>1-r?(n-(1-r))/r*-this.attributes.maxRotationOffset:0}},e.default=n},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=2*Math.PI,s=function(t){return new THREE.Vector3(t.x,t.y,t.z)},n=function(t,e){return new THREE.Vector3(t.x+e.x,t.y+e.y,t.z+e.z)},r=function(t,e){return new THREE.Vector3(t.x-e.x,t.y-e.y,t.z-e.z)},a=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0==e?t:new THREE.Vector3(t.x/e,t.y/e,t.z/e)},h=function(t){return t.x*=-1,t.y*=-1,t.z*=-1,t},u=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2))},c=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.z-t.z,2))},l=function(t,e){var i=c(t,e),o=e.y-t.y;return Math.atan2(o,i)},m=function(t,e){return new THREE.Vector3(t.x*e,t.y*e,t.z*e)},f=function(t,e){return t.x===e.x&&t.y===e.y&t.z===e.z},y=function(t,e){return new THREE.Vector3(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},d=function(t,e){return Math.atan2(Math.sin(e-t),Math.cos(e-t))},p=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z};e.copyVector=s,e.isVectorEqual=f,e.pitchBetween=l,e.twoPi=o,e.distanceBetween=u,e.distanceBetween2D=c,e.minAngleDifference=d,e.dotProduct=p,e.addVector=n,e.subtractVector=r,e.scaleVector=m,e.crossProduct=y,e.reverseVector=h,e.normalise=a}]);