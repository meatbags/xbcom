var XB=function(t){function e(o){if(i[o])return i[o].exports;var n=i[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,o){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={Loader:{glassOpacity:.5,lightMapIntensity:1},Area:{collision:{min:-50,max:50},walk:{min:0,max:100}},Player:{height:15,position:{x:0,y:0,z:0},rotation:{pitch:0,yaw:Math.PI,roll:0,maxPitch:.25*Math.PI,minPitch:-.25*Math.PI},speed:{normal:20,slowed:4,rotation:.75*Math.PI,jump:6},climb:{up:1,down:.5,minPlaneYAngle:.5}},Ship:{position:{x:0,y:0,z:0}},HUD:{turnThreshold:.4,maxYawRotation:.3*Math.PI},Camera:{fov:58,aspect:1,near:.1,far:1e4},Physics:{gravity:10,maxVelocity:50},Adjust:{slow:.025,normal:.05,fast:.09,veryFast:.2}};e.default=o},function(t,e,i){"use strict";var o=i(2),n=function(t){return t&&t.__esModule?t:{default:t}}(o),a={init:function(){a.renderer=new THREE.WebGLRenderer,a.renderer.setSize(960,540),a.renderer.setClearColor(16377314,1),document.getElementById("wrapper").appendChild(a.renderer.domElement),a.scene=new n.default(a.renderer.domElement),a.bindEvents(),a.loading()},bindEvents:function(){window.onresize=a.resize,a.resize()},resize:function(){a.scene.resize()},loading:function(){a.scene.isLoaded()?(a.time=(new Date).getTime(),a.loop()):requestAnimationFrame(a.loading)},loop:function(){requestAnimationFrame(a.loop);var t=(new Date).getTime(),e=(t-a.time)/1e3;a.time=t,a.scene.update(e),a.renderer.render(a.scene.scene,a.scene.camera)}};window.onload=a.init},function(t,e,i){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=i(3),a=o(n),s=i(5),r=o(s),h=function(t){this.domElement=t,this.init()};h.prototype={init:function(){var t=this;t.loader=new r.default("./assets/"),t.player=new a.default(t.domElement),t.camera=t.player.camera,t.scene=new THREE.Scene,t.scene.add(t.player.object),t.collider=new Collider.System,t.loadMaps(),t.loadLighting()},loadMaps:function(){var t=this;t.toLoad=2,this.loader.loadOBJ("map").then(function(e){var i=e.clone(),o=e.clone(),n=e.clone();i.position.set(0,0,100),o.position.set(100,0,0),n.position.set(100,0,100),t.scene.add(e,i,o,n),t.toLoad-=1},function(t){throw t}),t.loader.loadOBJ("collision_map").then(function(e){for(var i=0;i<e.children.length;i+=1)t.collider.add(new Collider.Mesh(e.children[i].geometry));t.toLoad-=1},function(t){throw t})},loadLighting:function(){var t=this;t.lights={a1:new THREE.AmbientLight(16777215,.25),d1:new THREE.DirectionalLight(16777215,1),p1:new THREE.PointLight(16777215,.5,50,1)},t.lights.p1.position.set(0,20,0),t.scene.add(t.lights.a1,t.lights.d1)},isLoaded:function(){return this.toLoad<=0},update:function(t){var e=this;e.player.update(t,e.collider)},resize:function(){}},e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(4),n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(o),a=i(0),s=function(t){return t&&t.__esModule?t:{default:t}}(a),r=function(t){this.domElement=t,this.position=new THREE.Vector3(s.default.Player.position.x,s.default.Player.position.y,s.default.Player.position.z),this.rotation={pitch:s.default.Player.rotation.pitch,yaw:s.default.Player.rotation.yaw,roll:s.default.Player.rotation.roll},this.movement=new THREE.Vector3(0,0,0),this.offset={rotation:{pitch:0,yaw:0}},this.target={position:new THREE.Vector3(s.default.Player.position.x,s.default.Player.position.y,s.default.Player.position.z),rotation:{pitch:s.default.Player.rotation.pitch,yaw:s.default.Player.rotation.yaw},movement:new THREE.Vector3(0,0,0),offset:{rotation:{pitch:0,yaw:0}}},this.falling=!1,this.config=s.default.Player,this.config.physics=s.default.Physics,this.config.hud=s.default.HUD,this.config.adjust=s.default.Adjust,this.config.area=s.default.Area,this.camera=new THREE.PerspectiveCamera(s.default.Camera.fov,s.default.Camera.aspect,s.default.Camera.near,s.default.Camera.far),this.camera.up=new THREE.Vector3(0,1,0),this.object=new THREE.Group,this.init()};r.prototype={init:function(){this.light=new THREE.PointLight(16777215,.5,25,2),this.light.position.set(0,1,0),this.object.add(this.light),this.bindControls(),this.resizeCamera()},resizeCamera:function(){var t=this.domElement.width,e=this.domElement.height;this.camera.aspect=t/e,this.camera.updateProjectionMatrix()},bindControls:function(){var t=this;t.keys={up:!1,down:!1,left:!1,right:!1,jump:!1},t.mouse={x:0,y:0,start:{x:0,y:0},delta:{x:0,y:0},rotation:{pitch:0,yaw:0},locked:!1,active:!1},t.domElement.addEventListener("click",function(t){},!1),t.domElement.addEventListener("mousedown",function(e){t.handleMouseDown(e)},!1),t.domElement.addEventListener("mousemove",function(e){t.handleMouseMove(e)},!1),t.domElement.addEventListener("mouseup",function(e){t.handleMouseUp(e)},!1),t.domElement.addEventListener("mouseleave",function(e){t.handleMouseUp(e)},!1),document.addEventListener("keydown",function(e){t.handleKeyDown(e)},!1),document.addEventListener("keyup",function(e){t.handleKeyUp(e)},!1)},handleInput:function(t){if(this.keys.left||this.keys.right){var e=(this.keys.left?1:0)+(this.keys.right?-1:0);this.target.rotation.yaw+=this.config.speed.rotation*t*e}if(this.keys.up||this.keys.down){var i=(this.keys.up?1:0)+(this.keys.down?-1:0),o=this.rotation.yaw+this.offset.rotation.yaw,n=Math.sin(o)*this.config.speed.normal*i,a=Math.cos(o)*this.config.speed.normal*i;this.target.movement.x=n,this.target.movement.z=a}else this.target.movement.x=0,this.target.movement.z=0;this.keys.jump&&(this.keys.jump=!1,0==this.movement.y&&(this.movement.y=this.config.speed.jump)),this.falling=0!=this.movement.y,this.falling?(this.movement.x+=(this.target.movement.x-this.movement.x)*this.config.adjust.slow,this.movement.z+=(this.target.movement.z-this.movement.z)*this.config.adjust.slow):(this.movement.x=this.target.movement.x,this.movement.z=this.target.movement.z)},checkCollisions:function(t,e){var i=n.addVector(n.scaleVector(this.movement,t),this.target.position),o=n.wrap(i.x,this.config.area.collision.min,this.config.area.collision.max)-i.x,a=n.wrap(i.z,this.config.area.collision.min,this.config.area.collision.max)-i.z;i.x+=o,i.z+=a;var s=e.collisions(i);if(this.movement.y=Math.max(this.movement.y-this.config.physics.gravity*t,-this.config.physics.maxVelocity),s.length>0){for(var r=0;r<s.length;r+=1){var h=s[r].ceilingPlane(i);null!=h.y&&h.plane.normal.y>=this.config.climb.minPlaneYAngle&&h.y-this.target.position.y<=this.config.climb.up&&(this.movement.y=0,h.y>=i.y&&(i.y=h.y))}s=e.collisions(i);for(var l=[],c=0;c<s.length;c+=1){var u=s[c].ceilingPlane(i);null!=u.y&&(u.plane.normal.y<this.config.climb.minPlaneYAngle||u.y-this.target.position.y>this.config.climb.up)&&l.push(s[c])}if(l.length>0){for(var d=n.copyVector(i),m=0;m<l.length;m+=1){d=l[m].nearest2DIntersect(this.target.position,i)}i.x=d.x,i.z=d.z;var f=0;s=e.collisions(i);for(var p=0;p<s.length;p+=1){var y=s[p].ceilingPlane(i);null!=y.y&&(y.plane.normal.y<this.config.climb.minPlaneYAngle||y.y-this.target.position.y>this.config.climb.up)&&(f+=1)}f>1&&(i.x=this.target.position.x,i.z=this.target.position.z)}}else{var g=n.copyVector(i);if(g.y-=this.config.climb.down,!this.falling&&e.collision(g)){var w=e.ceilingPlane(g);w.plane.normal.y>=this.config.climb.minPlaneYAngle&&(i.y=w.y,this.movement.y=0)}}i.x-=o,i.z-=a,this.target.position.x=i.x,this.target.position.y=i.y,this.target.position.z=i.z},move:function(){var t=n.wrap(this.target.position.x,this.config.area.walk.min,this.config.area.walk.max),e=n.wrap(this.target.position.z,this.config.area.walk.min,this.config.area.walk.max);this.position.x=t+(this.position.x-this.target.position.x),this.position.z=e+(this.position.z-this.target.position.z),this.target.position.x=t,this.target.position.z=e,this.position.x+=(this.target.position.x-this.position.x)*this.config.adjust.veryFast,this.position.y+=(this.target.position.y-this.position.y)*this.config.adjust.veryFast,this.position.z+=(this.target.position.z-this.position.z)*this.config.adjust.veryFast,this.rotation.yaw+=n.minAngleDifference(this.rotation.yaw,this.target.rotation.yaw)*this.config.adjust.fast,this.offset.rotation.yaw+=(this.target.offset.rotation.yaw-this.offset.rotation.yaw)*this.config.adjust.normal,this.rotation.yaw+=this.rotation.yaw<0?n.twoPi:this.rotation.yaw>n.twoPi?-n.twoPi:0,this.rotation.pitch+=(this.target.rotation.pitch-this.rotation.pitch)*this.config.adjust.normal,this.offset.rotation.pitch+=(this.target.offset.rotation.pitch-this.offset.rotation.pitch)*this.config.adjust.normal;var i=this.rotation.pitch+this.offset.rotation.pitch,o=this.rotation.yaw+this.offset.rotation.yaw,a=this.position.y+this.config.height;this.camera.position.set(this.position.x,a,this.position.z),this.camera.lookAt(new THREE.Vector3(this.position.x+Math.sin(o),a+Math.sin(i),this.position.z+Math.cos(o))),this.object.position.set(this.position.x,this.position.y,this.position.z)},update:function(t,e){this.handleInput(t),this.checkCollisions(t,e),this.move()},handleKeyDown:function(t){switch(t.keyCode){case 38:case 87:this.keys.up=!0;break;case 37:case 65:this.keys.left=!0;break;case 40:case 83:this.keys.down=!0;break;case 39:case 68:this.keys.right=!0;break;case 32:this.keys.jump=!0}},handleKeyUp:function(t){switch(t.keyCode){case 38:case 87:this.keys.up=!1;break;case 37:case 65:this.keys.left=!1;break;case 40:case 83:this.keys.down=!1;break;case 39:case 68:this.keys.right=!1}},handleMouseDown:function(t){if(!this.mouse.locked){var e=this.domElement.getBoundingClientRect();this.mouse.active=!0,this.mouse.rotation.pitch=this.rotation.pitch,this.mouse.rotation.yaw=this.rotation.yaw,this.mouse.start.x=t.clientX/this.domElement.width*2-1,this.mouse.start.y=(t.clientY-e.y)/this.domElement.height*2-1}},handleMouseMove:function(t){if(this.mouse.active){var e=this.domElement.getBoundingClientRect();this.mouse.x=t.clientX/this.domElement.width*2-1,this.mouse.y=(t.clientY-e.y)/this.domElement.height*2-1,this.mouse.delta.x=this.mouse.x-this.mouse.start.x,this.mouse.delta.y=this.mouse.y-this.mouse.start.y,this.target.rotation.yaw=this.mouse.rotation.yaw+this.mouse.delta.x;var i=this.mouse.rotation.pitch+this.mouse.delta.y;(i>this.config.rotation.maxPitch||i<this.config.rotation.minPitch)&&(i=Math.max(this.config.rotation.minPitch,Math.min(this.config.rotation.maxPitch,i)),this.mouse.start.y=this.mouse.y,this.mouse.rotation.pitch=i),this.target.rotation.pitch=i}},handleMouseUp:function(t){this.mouse.active=!1}},e.default=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=2*Math.PI,n=function(t,e,i){return t<e?t+=i-e:t>i&&(t-=i-e),t},a=function(t){return new THREE.Vector3(t.x,t.y,t.z)},s=function(t,e){return new THREE.Vector3(t.x+e.x,t.y+e.y,t.z+e.z)},r=function(t,e){return new THREE.Vector3(t.x-e.x,t.y-e.y,t.z-e.z)},h=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0==e?t:new THREE.Vector3(t.x/e,t.y/e,t.z/e)},l=function(t){return t.x*=-1,t.y*=-1,t.z*=-1,t},c=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2))},u=function(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.z-t.z,2))},d=function(t,e){var i=u(t,e),o=e.y-t.y;return Math.atan2(o,i)},m=function(t,e){return new THREE.Vector3(t.x*e,t.y*e,t.z*e)},f=function(t,e){return t.x===e.x&&t.y===e.y&t.z===e.z},p=function(t,e){return new THREE.Vector3(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)},y=function(t,e){return Math.atan2(Math.sin(e-t),Math.cos(e-t))},g=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z};e.wrap=n,e.copyVector=a,e.isVectorEqual=f,e.pitchBetween=d,e.twoPi=o,e.distanceBetween=c,e.distanceBetween2D=u,e.minAngleDifference=y,e.dotProduct=g,e.addVector=s,e.subtractVector=r,e.scaleVector=m,e.crossProduct=p,e.reverseVector=l,e.normalise=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(0),n=function(t){return t&&t.__esModule?t:{default:t}}(o),a=function(t){this.basePath=t,this.init()};a.prototype={init:function(){this.materialLoader=new THREE.MTLLoader,this.objectLoader=new THREE.OBJLoader,this.materialLoader.setPath(this.basePath),this.objectLoader.setPath(this.basePath)},process:function(t,e){for(var i=0;i<t.children.length;i+=1){var o=t.children[i],a=e.materialsInfo[o.material.name];if(o.material=e.materials[o.material.name],a.map_ka){var s=o.geometry.attributes.uv.array,r=a.map_ka,h=(new THREE.TextureLoader).load(self.basePath+r);o.material.lightMap=h,o.material.lightMapIntensity=n.default.Loader.lightMapIntensity,o.geometry.addAttribute("uv2",new THREE.BufferAttribute(s,2))}o.material.map&&(o.material.color=new THREE.Color(16777215),-1!==o.material.map.image.src.indexOf(".png")&&(o.material.transparent=!0,o.material.side=THREE.DoubleSide),-1!=o.material.map.image.src.indexOf("glass")&&(o.material.transparent=!0,o.material.opacity=n.default.Loader.glassOpacity))}},loadOBJ:function(t){var e=this;return new Promise(function(i,o){try{e.materialLoader.load(t+".mtl",function(o){o.preload(),e.objectLoader.load(t+".obj",function(t){e.process(t,o),i(t)})})}catch(t){o(t)}})}},e.default=a}]);