var XB=function(t){function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}var e={};return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="",i(i.s=2)}([function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o={Global:{fogColour:16377314,fogDensity:.01,timeDeltaMax:.05},Loader:{glassOpacity:.5,lightMapIntensity:1},Area:{collision:{min:-125,max:375},walk:{min:0,max:500}},Player:{height:1.9,position:{x:0,y:0,z:0},rotation:{pitch:0,yaw:.29*Math.PI,roll:0,maxPitch:.25*Math.PI,minPitch:-.25*Math.PI},speed:{normal:8,slowed:4,rotation:.75*Math.PI,jump:6,fallTimerThreshold:.1},climb:{up:1,down:.5,minPlaneYAngle:.55}},Ship:{position:{x:270,y:32,z:270},speed:20,rotation:{pitch:0,yaw:0}},HUD:{turnThreshold:.4,maxYawRotation:.3*Math.PI},Camera:{fov:58,aspect:1,near:.1,far:1e4},Physics:{gravity:12,maxVelocity:50},Adjust:{verySlow:.01,slow:.025,normal:.05,fast:.09,rapid:.15,veryFast:.2}};i.default=o},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=2*Math.PI,n=function(t,i,e){return t<i?t+=e-i:t>e&&(t-=e-i),t},s=function(t){return new THREE.Vector3(t.x,t.y,t.z)},a=function(t,i){return new THREE.Vector3(t.x+i.x,t.y+i.y,t.z+i.z)},r=function(t,i){return new THREE.Vector3(t.x-i.x,t.y-i.y,t.z-i.z)},h=function(t){var i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);return 0==i?t:new THREE.Vector3(t.x/i,t.y/i,t.z/i)},l=function(t){return t.x*=-1,t.y*=-1,t.z*=-1,t},c=function(t,i){return Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)+Math.pow(i.z-t.z,2))},u=function(t,i){return Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.z-t.z,2))},d=function(t,i){var e=u(t,i),o=i.y-t.y;return Math.atan2(o,e)},f=function(t,i){return new THREE.Vector3(t.x*i,t.y*i,t.z*i)},p=function(t,i){return t.x===i.x&&t.y===i.y&t.z===i.z},m=function(t,i){return new THREE.Vector3(t.y*i.z-t.z*i.y,t.z*i.x-t.x*i.z,t.x*i.y-t.y*i.x)},y=function(t,i){return Math.atan2(Math.sin(i-t),Math.cos(i-t))},g=function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z};i.wrap=n,i.copyVector=s,i.isVectorEqual=p,i.pitchBetween=d,i.twoPi=o,i.distanceBetween=c,i.distanceBetween2D=u,i.minAngleDifference=y,i.dotProduct=g,i.addVector=a,i.subtractVector=r,i.scaleVector=f,i.crossProduct=m,i.reverseVector=l,i.normalise=h},function(t,i,e){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}var n=e(3),s=o(n),a=e(0),r=o(a),h={init:function(){h.renderer=new THREE.WebGLRenderer({antialias:!1}),h.renderer.setClearColor(r.default.Global.fogColour,1),document.getElementById("wrapper").appendChild(h.renderer.domElement),h.scene=new s.default(h.renderer.domElement),h.bindEvents(),h.loading()},bindEvents:function(){window.onresize=h.resize,h.resize()},resize:function(){var t=window.innerWidth,i=window.innerHeight;h.renderer.setSize(t,i),h.renderer.domElement.width=t,h.renderer.domElement.height=i,h.scene.resize()},loading:function(){h.scene.isLoaded()?(h.time=(new Date).getTime(),h.loop()):requestAnimationFrame(h.loading)},loop:function(){requestAnimationFrame(h.loop);var t=(new Date).getTime(),i=(t-h.time)/1e3;h.time=t,h.scene.update(i>r.default.Global.timeDeltaMax?r.default.Global.timeDeltaMax:i),h.renderer.render(h.scene.scene,h.scene.camera)}};window.onload=h.init},function(t,i,e){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var n=e(4),s=o(n),a=e(6),r=o(a),h=e(0),l=o(h),c=function(t){this.domElement=t,this.init()};c.prototype={init:function(){var t=this;t.loader=new r.default("./assets/"),t.player=new s.default(t.domElement),t.camera=t.player.camera,t.scene=new THREE.Scene,t.scene.add(t.player.object),t.collider={objects:new Collider.System,ground:new Collider.System},t.loadMaps(),t.loadLighting()},resize:function(){this.player.resizeCamera()},loadMaps:function(){var t=this;t.toLoad=2,this.loader.loadOBJ("map").then(function(i){var e=i.clone(),o=i.clone(),n=i.clone();e.position.set(0,0,l.default.Area.walk.max),o.position.set(l.default.Area.walk.max,0,0),n.position.set(l.default.Area.walk.max,0,l.default.Area.walk.max),t.scene.add(i,e,o,n),t.toLoad-=1},function(t){throw t}),t.loader.loadOBJ("collision_map_ground").then(function(i){for(var e=0;e<i.children.length;e+=1)t.collider.ground.add(new Collider.Mesh(i.children[e].geometry));t.toLoad-=1},function(t){throw t}),t.loader.loadOBJ("collision_map_objects").then(function(i){for(var e=0;e<i.children.length;e+=1)t.collider.objects.add(new Collider.Mesh(i.children[e].geometry));t.toLoad-=1},function(t){throw t})},loadLighting:function(){var t=this;t.lights={a1:new THREE.AmbientLight(16777215,.25),d1:new THREE.DirectionalLight(16777215,.5),p1:new THREE.PointLight(16777215,.5,50,1)},t.lights.p1.position.set(0,20,0),t.scene.add(t.lights.a1,t.lights.d1),t.scene.fog=new THREE.FogExp2(l.default.Global.fogColour,l.default.Global.fogDensity)},isLoaded:function(){return this.toLoad<=0},update:function(t){var i=this;i.player.update(t,i.collider.ground,i.collider.objects)}},i.default=c},function(t,i,e){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(i,"__esModule",{value:!0});var n=e(1),s=function(t){if(t&&t.__esModule)return t;var i={};if(null!=t)for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);return i.default=t,i}(n),a=e(5),r=o(a),h=e(0),l=o(h),c=e(7),u=o(c),d=function(t){this.domElement=t,this.position=new THREE.Vector3(l.default.Player.position.x,l.default.Player.position.y,l.default.Player.position.z),this.rotation={pitch:l.default.Player.rotation.pitch,yaw:l.default.Player.rotation.yaw,roll:l.default.Player.rotation.roll},this.movement=new THREE.Vector3(0,0,0),this.offset={rotation:{pitch:0,yaw:0}},this.target={position:new THREE.Vector3(l.default.Player.position.x,l.default.Player.position.y,l.default.Player.position.z),rotation:{pitch:l.default.Player.rotation.pitch,yaw:l.default.Player.rotation.yaw},movement:new THREE.Vector3(0,0,0),offset:{rotation:{pitch:0,yaw:0}}},this.falling=!1,this.fallTimer=0,this.config=l.default.Player,this.config.physics=l.default.Physics,this.config.hud=l.default.HUD,this.config.adjust=l.default.Adjust,this.config.area=l.default.Area,this.camera=new THREE.PerspectiveCamera(l.default.Camera.fov,l.default.Camera.aspect,l.default.Camera.near,l.default.Camera.far),this.camera.up=new THREE.Vector3(0,1,0),this.object=new THREE.Group,this.init()};d.prototype={init:function(){this.light=new THREE.PointLight(16777215,.5,25,2),this.light.position.set(0,1,0),this.object.add(this.light),this.ship=new r.default,this.bindControls(),this.resizeCamera(),this.logger=new u.default},handleInput:function(t){if(this.keys.e&&(this.keys.e=!1,this.ship.toggle()),this.keys.left||this.keys.right){var i=(this.keys.left?1:0)+(this.keys.right?-1:0);this.target.rotation.yaw+=this.config.speed.rotation*t*i}if(this.keys.up||this.keys.down){var e=(this.keys.up?1:0)+(this.keys.down?-1:0),o=this.rotation.yaw+this.offset.rotation.yaw,n=Math.sin(o)*this.config.speed.normal*e,s=Math.cos(o)*this.config.speed.normal*e;this.target.movement.x=n,this.target.movement.z=s}else this.target.movement.x=0,this.target.movement.z=0;this.keys.jump&&(this.keys.jump=!1,(0==this.movement.y||this.fallTimer<this.cofig.speed.fallTimerThreshold)&&(this.movement.y=this.config.speed.jump)),this.falling=0!=this.movement.y,this.falling?this.fallTimer+=t:this.fallTimer=0,this.falling?(this.movement.x+=(this.target.movement.x-this.movement.x)*this.config.adjust.slow,this.movement.z+=(this.target.movement.z-this.movement.z)*this.config.adjust.slow):(this.movement.x=this.target.movement.x,this.movement.z=this.target.movement.z)},checkCollisions:function(t,i,e){var o=s.addVector(s.scaleVector(this.movement,t),this.target.position),n=s.wrap(o.x,this.config.area.collision.min,this.config.area.collision.max)-o.x,a=s.wrap(o.z,this.config.area.collision.min,this.config.area.collision.max)-o.z;o.x+=n,o.z+=a;var r=e.collisions(o);if(this.movement.y=Math.max(this.movement.y-this.config.physics.gravity*t,-this.config.physics.maxVelocity),r.length>0){for(var h=0;h<r.length;h+=1){var l=r[h].ceilingPlane(o);null!=l.y&&l.plane.normal.y>=this.config.climb.minPlaneYAngle&&l.y-this.target.position.y<=this.config.climb.up&&(this.movement.y=0,l.y>=o.y&&(o.y=l.y))}r=e.collisions(o);for(var c=[],u=0;u<r.length;u+=1){var d=r[u].ceilingPlane(o);null!=d.y&&(d.plane.normal.y<this.config.climb.minPlaneYAngle||d.y-this.target.position.y>this.config.climb.up)&&c.push(r[u])}if(c.length>0){for(var f=s.copyVector(o),p=0;p<c.length;p+=1){f=c[p].nearest2DIntersect(this.target.position,o)}o.x=f.x,o.z=f.z;var m=0;r=e.collisions(o);for(var y=0;y<r.length;y+=1){var g=r[y].ceilingPlane(o);null!=g.y&&(g.plane.normal.y<this.config.climb.minPlaneYAngle||g.y-this.target.position.y>this.config.climb.up)&&(m+=1)}m>1&&(o.x=this.target.position.x,o.z=this.target.position.z)}}else{var w=s.copyVector(o);if(w.y-=this.config.climb.down,!this.falling&&i.collision(w)){var v=i.ceilingPlane(w);v.plane.normal.y>=this.config.climb.minPlaneYAngle&&(o.y=v.y,this.movement.y=0)}if(0!=this.movement.y&&e.collision(w)){var x=e.ceilingPlane(w);x.plane.normal.y>=this.config.climb.minPlaneYAngle&&(o.y=x.y,this.movement.y=0)}}if(this.logger.print(this.movement.y),0!=this.movement.y){var E=i.ceiling(new THREE.Vector3(o.x,0,o.z));null!=E&&o.y<=E?(o.y=E,this.movement.y=0):o.y<=0&&(o.y=0,this.movement.y=0)}o.x-=n,o.z-=a,this.target.position.x=o.x,this.target.position.y=o.y,this.target.position.z=o.z},move:function(){var t=s.wrap(this.target.position.x,this.config.area.walk.min,this.config.area.walk.max),i=s.wrap(this.target.position.z,this.config.area.walk.min,this.config.area.walk.max);this.position.x=t+(this.position.x-this.target.position.x),this.position.z=i+(this.position.z-this.target.position.z),this.target.position.x=t,this.target.position.z=i,this.position.x+=(this.target.position.x-this.position.x)*this.config.adjust.veryFast,this.position.y+=(this.target.position.y-this.position.y)*this.config.adjust.rapid,this.position.z+=(this.target.position.z-this.position.z)*this.config.adjust.veryFast,this.rotation.yaw+=s.minAngleDifference(this.rotation.yaw,this.target.rotation.yaw)*this.config.adjust.fast,this.offset.rotation.yaw+=(this.target.offset.rotation.yaw-this.offset.rotation.yaw)*this.config.adjust.normal,this.rotation.yaw+=this.rotation.yaw<0?s.twoPi:this.rotation.yaw>s.twoPi?-s.twoPi:0,this.rotation.pitch+=(this.target.rotation.pitch-this.rotation.pitch)*this.config.adjust.normal,this.offset.rotation.pitch+=(this.target.offset.rotation.pitch-this.offset.rotation.pitch)*this.config.adjust.normal;var e=this.rotation.pitch+this.offset.rotation.pitch,o=this.rotation.yaw+this.offset.rotation.yaw,n=this.position.y+this.config.height;this.camera.position.set(this.position.x,n,this.position.z),this.camera.lookAt(new THREE.Vector3(this.position.x+Math.sin(o),n+Math.sin(e),this.position.z+Math.cos(o))),this.object.position.set(this.position.x,this.position.y,this.position.z)},update:function(t,i,e){this.ship.active?(this.handleInput(t),this.ship.target.rotation.yaw=this.rotation.yaw,this.ship.update(t,i),this.target.position.set(this.ship.position.x,this.ship.position.y,this.ship.position.z),this.position.set(this.ship.position.x,this.ship.position.y,this.ship.position.z),this.move()):(this.handleInput(t),this.checkCollisions(t,i,e),this.move())},handleKeyDown:function(t){switch(t.keyCode){case 38:case 87:this.keys.up=!0;break;case 37:case 65:this.keys.left=!0;break;case 40:case 83:this.keys.down=!0;break;case 39:case 68:this.keys.right=!0;break;case 32:this.keys.jump=!0;break;case 69:this.keys.e=!0}},handleKeyUp:function(t){switch(t.keyCode){case 38:case 87:this.keys.up=!1;break;case 37:case 65:this.keys.left=!1;break;case 40:case 83:this.keys.down=!1;break;case 39:case 68:this.keys.right=!1}},handleMouseDown:function(t){if(!this.mouse.locked){var i=this.domElement.getBoundingClientRect();this.mouse.active=!0,this.mouse.rotation.pitch=this.rotation.pitch,this.mouse.rotation.yaw=this.rotation.yaw,this.mouse.start.x=t.clientX/this.domElement.width*2-1,this.mouse.start.y=(t.clientY-i.y)/this.domElement.height*2-1}},handleMouseMove:function(t){if(this.mouse.active&&!this.keys.left&&!this.keys.right){var i=this.domElement.getBoundingClientRect();this.mouse.x=t.clientX/this.domElement.width*2-1,this.mouse.y=(t.clientY-i.y)/this.domElement.height*2-1,this.mouse.delta.x=this.mouse.x-this.mouse.start.x,this.mouse.delta.y=this.mouse.y-this.mouse.start.y,this.target.rotation.yaw=this.mouse.rotation.yaw+this.mouse.delta.x;var e=this.mouse.rotation.pitch+this.mouse.delta.y;(e>this.config.rotation.maxPitch||e<this.config.rotation.minPitch)&&(e=Math.max(this.config.rotation.minPitch,Math.min(this.config.rotation.maxPitch,e)),this.mouse.start.y=this.mouse.y,this.mouse.rotation.pitch=e),this.target.rotation.pitch=e}},handleMouseUp:function(t){this.mouse.active=!1},resizeCamera:function(){var t=this.domElement.width,i=this.domElement.height;this.camera.aspect=t/i,this.camera.updateProjectionMatrix()},bindControls:function(){var t=this;t.keys={up:!1,down:!1,left:!1,right:!1,jump:!1,e:!1},t.mouse={x:0,y:0,start:{x:0,y:0},delta:{x:0,y:0},rotation:{pitch:0,yaw:0},locked:!1,active:!1},t.domElement.addEventListener("click",function(t){},!1),t.domElement.addEventListener("mousedown",function(i){t.handleMouseDown(i)},!1),t.domElement.addEventListener("mousemove",function(i){t.handleMouseMove(i)},!1),t.domElement.addEventListener("mouseup",function(i){t.handleMouseUp(i)},!1),t.domElement.addEventListener("mouseleave",function(i){t.handleMouseUp(i)},!1),document.addEventListener("keydown",function(i){t.handleKeyDown(i)},!1),document.addEventListener("keyup",function(i){t.handleKeyUp(i)},!1)}},i.default=d},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=e(0),n=function(t){return t&&t.__esModule?t:{default:t}}(o),s=e(1),a=function(){this.active=!0,this.position=new THREE.Vector3(n.default.Ship.position.x,n.default.Ship.position.y,n.default.Ship.position.z),this.rotation={pitch:n.default.Ship.rotation.pitch,yaw:n.default.Ship.rotation.yaw},this.target={position:new THREE.Vector3(n.default.Ship.position.x,n.default.Ship.position.y,n.default.Ship.position.z),rotation:{pitch:n.default.Ship.rotation.pitch,yaw:n.default.Ship.rotation.yaw}},this.speed=n.default.Ship.speed,this.config=n.default.Ship,this.config.area=n.default.Area,this.config.adjust=n.default.Adjust};a.prototype={update:function(t,i){this.rotation.yaw+=this.config.adjust.slow*(0,s.minAngleDifference)(this.rotation.yaw,this.target.rotation.yaw),this.target.position.x+=this.speed*Math.sin(this.rotation.yaw)*t,this.target.position.z+=this.speed*Math.cos(this.rotation.yaw)*t;var e=(0,s.wrap)(this.target.position.x,this.config.area.walk.min,this.config.area.walk.max),o=(0,s.wrap)(this.target.position.z,this.config.area.walk.min,this.config.area.walk.max);this.position.x=e+(this.position.x-this.target.position.x),this.position.z=o+(this.position.z-this.target.position.z),this.target.position.x=e,this.target.position.z=o,this.position.x+=(this.target.position.x-this.position.x)*this.config.adjust.veryFast,this.position.y+=(this.target.position.y-this.position.y)*this.config.adjust.veryFast,this.position.z+=(this.target.position.z-this.position.z)*this.config.adjust.veryFast},toggle:function(){this.active=0==this.active}},i.default=a},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=e(0),n=function(t){return t&&t.__esModule?t:{default:t}}(o),s=function(t){this.basePath=t,this.init()};s.prototype={init:function(){this.materialLoader=new THREE.MTLLoader,this.objectLoader=new THREE.OBJLoader,this.materialLoader.setPath(this.basePath),this.objectLoader.setPath(this.basePath)},process:function(t,i){for(var e=0;e<t.children.length;e+=1){var o=t.children[e],s=i.materialsInfo[o.material.name];if(o.material=i.materials[o.material.name],s.map_ka){var a=o.geometry.attributes.uv.array,r=s.map_ka,h=(new THREE.TextureLoader).load(self.basePath+r);o.material.lightMap=h,o.material.lightMapIntensity=n.default.Loader.lightMapIntensity,o.geometry.addAttribute("uv2",new THREE.BufferAttribute(a,2))}o.material.map&&(o.material.color=new THREE.Color(16777215),-1!==o.material.map.image.src.indexOf(".png")&&(o.material.transparent=!0,o.material.side=THREE.DoubleSide),-1!=o.material.map.image.src.indexOf("glass")&&(o.material.transparent=!0,o.material.opacity=n.default.Loader.glassOpacity))}},loadOBJ:function(t){var i=this;return new Promise(function(e,o){try{i.materialLoader.load(t+".mtl",function(o){o.preload(),i.objectLoader.load(t+".obj",function(t){i.process(t,o),e(t)})})}catch(t){o(t)}})}},i.default=s},function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(){this.cvs=document.createElement("canvas"),this.ctx=this.cvs.getContext("2d"),this.init()};o.prototype={init:function(){document.body.append(this.cvs),this.setStyle()},setStyle:function(){this.cvs.style.position="fixed",this.cvs.width=window.innerWidth,this.cvs.style.pointerEvents="none",this.cvs.height=400,this.cvs.style.zIndex=10,this.cvs.style.top=0,this.cvs.style.left=0},clear:function(){this.ctx.clearRect(0,0,this.cvs.width,this.cvs.height)},print:function(){this.clear();for(var t=0;t<arguments.length;t+=1)this.ctx.fillText(arguments[t],20,20+20*t)}},i.default=o}]);